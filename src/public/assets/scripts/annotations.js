angular.module("dias.annotations").service("laserpoints",["LaserpointsImage","map","images",function(e,t,i){"use strict";var n,o={},a=!1,s=[new ol.style.Style({image:new ol.style.Circle({radius:6,stroke:new ol.style.Stroke({color:"white",width:4})})}),new ol.style.Style({image:new ol.style.Circle({radius:6,stroke:new ol.style.Stroke({color:"#ff0000",width:2,lineDash:[1]})})})],r=new ol.source.Vector,l=new ol.layer.Vector({source:r,style:s,zIndex:3,updateWhileAnimating:!0,updateWhileInteracting:!0});t.addLayer(l);var c=function(e){if("manual"!==e.method&&e.points&&0!==e.points.length){var t=i.currentImage.height;e.points.forEach(function(e){var i=new ol.Feature({geometry:new ol.geom.Point([e[0],t-e[1]])});r.addFeature(i)})}},u=function(t,i){r.clear(),o.hasOwnProperty(i._id)||(o[i._id]=e.get({image_id:i._id})),o[i._id].$promise.then(c)};this.show=function(e){a||(n=e.$on("image.shown",u),a=!0,i.currentImage&&u(null,i.currentImage))},this.hide=function(){a&&(n(),a=!1)},this.setOpacity=function(e){l.setOpacity(e)}}]),angular.module("dias.annotations").factory("LaserpointsImage",["$resource","URL",function(e,t){"use strict";return e(t+"/api/v1/images/:image_id/laserpoints")}]),angular.module("dias.annotations").controller("LaserpointsSettingsController",["$scope","laserpoints",function(e,t){"use strict";e.setDefaultSettings("laserpoint_opacity","1");var i="0"!=e.settings.laserpoint_opacity;e.$watch("settings.laserpoint_opacity",function(n){t.setOpacity(n),!i&&n>0?(t.show(e),i=!0):i&&0>=n&&(t.hide(),i=!1)}),"0"!=e.settings.laserpoint_opacity&&t.show(e)}]);