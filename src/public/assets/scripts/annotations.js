angular.module("dias.annotations").factory("LaserpointsImage",["$resource","URL",function(e,t){"use strict";return e(t+"/api/v1/images/:image_id/laserpoints")}]),angular.module("dias.annotations").controller("LaserpointsSettingsController",["$scope","laserpoints",function(e,t){"use strict";e.setDefaultSettings("laserpoint_opacity","1");var i="0"!=e.settings.laserpoint_opacity;e.$watch("settings.laserpoint_opacity",function(o){t.setOpacity(o),!i&&o>0?(t.show(e),i=!0):i&&0>=o&&(t.hide(),i=!1)}),"0"!=e.settings.laserpoint_opacity&&t.show(e)}]),angular.module("dias.annotations").service("laserpoints",["LaserpointsImage","map","images",function(e,t,i){"use strict";var o,n={},s=!1,a=[new ol.style.Style({image:new ol.style.Circle({radius:6,stroke:new ol.style.Stroke({color:"white",width:4})})}),new ol.style.Style({image:new ol.style.Circle({radius:6,stroke:new ol.style.Stroke({color:"#ff0000",width:2,lineDash:[1]})})})],r=new ol.source.Vector,l=new ol.layer.Vector({source:r,style:a,zIndex:3});t.addLayer(l);var c=function(e){if("heuristic"===e.method&&0!==e.points.length){var t=i.currentImage.height;e.points.forEach(function(e){var i=new ol.Feature({geometry:new ol.geom.Point([e[0],t-e[1]])});r.addFeature(i)})}},u=function(t,i){r.clear(),n.hasOwnProperty(i._id)||(n[i._id]=e.get({image_id:i._id})),n[i._id].$promise.then(c)};this.show=function(e){s||(o=e.$on("image.shown",u),s=!0,i.currentImage&&u(null,i.currentImage))},this.hide=function(){s&&(o(),s=!1)},this.setOpacity=function(e){l.setOpacity(e)}}]);