angular.module("dias.annotations").controller("LaserpointsSettingsController",["$scope","laserpoints",function(e,t){"use strict";e.setDefaultSettings("laserpoint_opacity","1");var o="0"!=e.settings.laserpoint_opacity;e.$watch("settings.laserpoint_opacity",function(i){t.setOpacity(i),!o&&i>0?(t.show(e),o=!0):o&&0>=i&&(t.hide(),o=!1)}),"0"!=e.settings.laserpoint_opacity&&t.show(e)}]),angular.module("dias.annotations").factory("LaserpointsImage",["$resource","URL",function(e,t){"use strict";return e(t+"/api/v1/images/:image_id/laserpoints")}]),angular.module("dias.annotations").service("laserpoints",["LaserpointsImage","map","images",function(e,t,o){"use strict";var i,n={},s=!1,a=[new ol.style.Style({image:new ol.style.Circle({radius:6,stroke:new ol.style.Stroke({color:"white",width:4})})}),new ol.style.Style({image:new ol.style.Circle({radius:6,stroke:new ol.style.Stroke({color:"#ff0000",width:2,lineDash:[1]})})})],r=new ol.source.Vector,l=new ol.layer.Vector({source:r,style:a,zIndex:3});t.addLayer(l);var c=function(e){if("manual"!==e.method&&e.points&&0!==e.points.length){var t=o.currentImage.height;e.points.forEach(function(e){var o=new ol.Feature({geometry:new ol.geom.Point([e[0],t-e[1]])});r.addFeature(o)})}},u=function(t,o){r.clear(),n.hasOwnProperty(o._id)||(n[o._id]=e.get({image_id:o._id})),n[o._id].$promise.then(c)};this.show=function(e){s||(i=e.$on("image.shown",u),s=!0,o.currentImage&&u(null,o.currentImage))},this.hide=function(){s&&(i(),s=!1)},this.setOpacity=function(e){l.setOpacity(e)}}]);