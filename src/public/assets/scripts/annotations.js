angular.module("dias.annotations").controller("LaserpointsSettingsController",["$scope","laserpoints",function(t,e){"use strict";t.setDefaultSettings("laserpoint_opacity","1");var i="0"!=t.settings.laserpoint_opacity;t.$watch("settings.laserpoint_opacity",function(n){e.setOpacity(n),!i&&n>0?(e.show(t),i=!0):i&&0>=n&&(e.hide(),i=!1)}),"0"!=t.settings.laserpoint_opacity&&e.show(t)}]),angular.module("dias.annotations").factory("LaserpointsImage",["$resource","URL",function(t,e){"use strict";return t(e+"/api/v1/images/:image_id/laserpoints")}]),angular.module("dias.annotations").service("laserpoints",["LaserpointsImage","map","images","styles",function(t,e,i,n){"use strict";var o,s={},a=!1,r=new ol.Collection,c=new ol.source.Vector({features:r}),l=new ol.layer.Vector({source:c,style:n.highlight,zIndex:2});e.addLayer(l);var u=function(t){if("heuristic"===t.method&&0!==t.points.length){var e=i.currentImage.height;t.points.forEach(function(t){var i=new ol.Feature({geometry:new ol.geom.Point([t[0],e-t[1]])});c.addFeature(i)})}},g=function(e,i){c.clear(),s.hasOwnProperty(i._id)||(s[i._id]=t.get({image_id:i._id})),s[i._id].$promise.then(u)};this.show=function(t){a||(o=t.$on("image.shown",g),a=!0,i.currentImage&&g(null,i.currentImage))},this.hide=function(){a&&(o(),a=!1)},this.setOpacity=function(t){l.setOpacity(t)}}]);