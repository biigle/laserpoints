angular.module("biigle.annotations").factory("LaserpointsImage",["$resource","URL",function(e,t){"use strict";return e(t+"/api/v1/images/:image_id/laserpoints")}]),angular.module("biigle.annotations").controller("LaserpointsSettingsController",["$scope","laserpoints","settings",function(e,t,n){"use strict";var i="laserpoint_opacity";n.setDefaultSettings(i,"1"),e[i]=n.getPermanentSettings(i);var o="0"!=e[i];e.$watch(i,function(a){n.setPermanentSettings(i,a),t.setOpacity(a),!o&&a>0?(t.show(e),o=!0):o&&0>=a&&(t.hide(),o=!1)}),o&&t.show(e)}]),angular.module("biigle.annotations").service("laserpoints",["LaserpointsImage","map","images",function(e,t,n){"use strict";var i,o={},a=!1,s=[new ol.style.Style({image:new ol.style.Circle({radius:6,stroke:new ol.style.Stroke({color:"white",width:4})})}),new ol.style.Style({image:new ol.style.Circle({radius:6,stroke:new ol.style.Stroke({color:"#ff0000",width:2,lineDash:[1]})})})],r=new ol.source.Vector,l=new ol.layer.Vector({source:r,style:s,zIndex:3,updateWhileAnimating:!0,updateWhileInteracting:!0});t.addLayer(l);var c=function(e){if("manual"!==e.method&&e.points&&0!==e.points.length){var t=n.currentImage.height;e.points.forEach(function(e){var n=new ol.Feature({geometry:new ol.geom.Point([e[0],t-e[1]])});r.addFeature(n)})}},u=function(t,n){r.clear(),o.hasOwnProperty(n._id)||(o[n._id]=e.get({image_id:n._id})),o[n._id].$promise.then(c)};this.show=function(e){a||(i=e.$on("image.shown",u),a=!0,n.currentImage&&u(null,n.currentImage))},this.hide=function(){a&&(i(),a=!1)},this.setOpacity=function(e){l.setOpacity(e)}}]);